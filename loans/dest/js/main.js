/*!
 * LastModifyTime: 2017-04-12 10:08:26
 * Copyright(c) 2017 H5项目管理
 */
var login={mobile:$("input[name=mobile]"),password:$("input[name=password]"),code:$("input[name=code]"),getCodeImg:function(){$.ajax({type:"post",url:url+"/user/captcha",dataType:"json",success:function(e){if(0==e.code){var t="data:image/jpeg;base64,"+e.dataSource.captcha;$(".login-codeimg").attr("src",t)}},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},changeCodeImg:function(){var e=this;$(".login-codeimg").on("click",function(){e.getCodeImg()})},clearMobile:function(){var e=this;$(".login-close").on("click",function(){e.mobile.val("")})},showPwd:function(){var e=this;$(".login-hide").on("click",function(){var t=e.password.attr("type");"text"===t?e.password.attr("type","password"):"password"===t&&e.password.attr("type","text")})},forgetPassword:function(){$(".login-fpwd").on("click",function(){$(".self-model").show()})},closeModel:function(){$(".self-model").on("click",function(){$(this).hide()})},loginFnc:function(){var e=this;$(".login-btn").on("click",function(){var t={account:e.mobile.val(),password:e.password.val(),captcha:e.code.val()};return""===t.account?($.tips({content:"请输入账号",stayTime:3e3}),e.mobile.focus(),!1):""===t.password?($.tips({content:"请输入密码",stayTime:3e3}),e.password.focus(),!1):t.password.length>12||t.password.length<6?($.tips({content:"密码长度为6-12位",stayTime:3e3}),e.password.focus(),!1):void $.ajax({type:"post",url:url+"/user/login",data:t,success:function(t){0==t.code?window.location.href="index.html":($.tips({content:t.msg,stayTime:3e3}),100002==t.code?($(".login-code-row").show(),$("input[name=code]").focus(),e.getCodeImg()):100004==t.code&&($(".login-code-row").show(),e.getCodeImg()))},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})})},init:function(){this.getCodeImg(),this.clearMobile(),this.showPwd(),this.forgetPassword(),this.closeModel(),this.loginFnc(),this.changeCodeImg()}},mine={getInfo:function(){$.ajax({type:"post",url:url+"/user/detail",success:function(e){if(0==e.code){var t=template("mineTemp",e.dataSource);$(".mine-box").html(t)}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:1e3})}})},exitFunc:function(){$(".mine-exit").on("click",function(){$.ajax({type:"post",url:url+"/user/logout",success:function(e){0==e.code&&(window.location.href="login.html")},error:function(){$.tips({content:message.serverErr,stayTime:1e3})}})})},init:function(){this.getInfo(),this.exitFunc()}},index={getInfo:function(){$.ajax({type:"post",url:url+"/loanHomePage/home",success:function(e){if(0==e.code){var t=template("indexTemp",e.dataSource.homePageInfo);$(".index-boxes").html(t)}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:1e3})}})},init:function(){this.getInfo()}},loanExpenditure={getList:function(){var e=getUrlParam({name:"moduleType"});$.ajax({type:"post",url:url+"/loanExpenditure/listByModule",data:{moduleType:e},success:function(t){if(0==t.code){t.dataSource.moduleType=e;var a=template("loanExpenditureTemp",t.dataSource);$(".loan-list").html(a),0!=t.dataSource.records.length&&$(".ui-loading-wrap").html(message.success)}else $.tips({content:t.msg,stayTime:3e3}),999001==t.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},showDailyDetails:function(){$(document).on("click",".more-bottom",function(){$(this).hasClass("active")?($(this).removeClass("active"),$(this).parent().children(".loan-more-list").addClass("none")):($(this).addClass("active"),$(this).parent().children(".loan-more-list").removeClass("none"))})},titleName:{currentMonthPrepare:"本月预还",nextMonthPrepare:"下月预还",currentMonthActual:"本月实还"},init:function(){var e=getUrlParam({name:"moduleType"});document.title=this.titleName[e],this.getList(),this.showDailyDetails()}},loanExpenditureChange={getList:function(e){var t=e?e:this,a={year:t.year};$.ajax({type:"post",url:url+"/loanExpenditure/changed",data:a,success:function(e){if(0==e.code){var t=template("loanExpenditureChangeTempHead",e.dataSource);$(".loanExpenditureChangeHeadList").html(t);var a=template("loanExpenditureChangeTemp",e.dataSource);$(".loanExpenditureChangeHead").html(a),e.dataSource.records&&0!=e.dataSource.records.length&&$(".ui-loading-wrap").html(message.success)}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},showDailyDetails:function(){$(document).on("click",".more-bottom",function(){$(this).hasClass("active")?($(this).removeClass("active"),$(this).parent().children(".loan-more-list").addClass("none")):($(this).addClass("active"),$(this).parent().children(".loan-more-list").removeClass("none"))})},changeYear:function(){var e=this,t=[],a=[];$(".loan-list-datetime").html(e.year),t=[];for(var n=2010;n<=e.year+20;n++)a.push(n);$(".loan-list-datetime").attr("data-date",e.year);var o=new WheelPicker({data:[a],value:[e.year],onSelect:function(t){e.keyWord="",e.year=t[0].value,e.getList(e),$(".loan-list-datetime").html(t[0].value),$(".loan-list-datetime").attr("data-date",t[0].value)}});$(document).on("click",".loan-selected-year",function(){return o.show(),!1})},init:function(){var e=new Date,t=e.getFullYear();this.year=t,this.getList(),this.changeYear(),this.showDailyDetails()}},loanMoreList={currentPage:1,getChangedMore:function(e){var t=e?e:this;$.ajax({type:"post",url:url+t.url,data:t.param,success:function(e){if(0==e.code){var e=e.dataSource;if("loan_expenditure"==t.from)var a=template("getMoreListTemp",e);else if("loan_expenditure_change"==t.from)var a=template("getMoreChangeListTemp",e);1==t.currentPage?$(".loan-getmore-list").html(a):$(".loan-getmore-list").append(a),0==e.totalPage?(tips({classname:"tips-no-message",content:message.noMssege}),$(".ui-loading-wrap").remove()):e.totalPage<=t.currentPage&&$(".ui-loading-wrap").html(message.success)}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},init:function(){this.from=getUrlParam({name:"from"}),"loan_expenditure"==this.from?(this.url="/loanExpenditure/listByModuleMore",this.param={moduleType:getUrlParam({name:"moduleType"}),pageNum:this.currentPage,day:getUrlParam({name:"day"})}):"loan_expenditure_change"==this.from&&(this.url="/loanExpenditure/changedMore",this.param={month:getUrlParam({name:"month"}),pageNum:this.currentPage}),this.callback=this.getChangedMore,this.getChangedMore(this),scrollFunc(this)}},search_page={keyWord:$("input[name=search]").val(),pageInit:function(){this.keyWord?this.getList(this):(tips({classname:"tips-search",content:message.searchMsg}),$(".search-list").addClass("none"),$(".ui-loading-wrap").addClass("none"))},getList:function(e){this.type="search",$(".self-tips").remove(),$(".search-list").addClass("none");var t=e&&e._this?e._this:this;$(".ui-loading-wrap").removeClass("none").html(message.loading),$.ajax({type:"post",url:url+"/search/list",data:{keyWord:t.keyWord},success:function(e){if(0==e.code){var t=e.dataSource,a=template("searchTemp",t);$(".search-list").removeClass("none").html(a),0===t.records.length?($(".ui-loading-wrap").addClass("none"),tips({divBox:".search-list",classname:"tips-change-word",content:message.changeWord})):$(".ui-loading-wrap").html(message.loadend)}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},setUrl:function(){var e=this;template.helper("setUrl",function(t,a){var n={Contract:"loan.html?",RepayPayable:"payments.html?repayCategory=Payable&",Node:"loan_node.html?",Guarantee:"surety.html?category=guaranteeInfo&",GuaranteeThing:"surety.html?category=loanThings&",Debtor:"loan_debtor.html?",Project:"pro_info.html?",ProjectPlan:"pro_play.html?",PlanReport:"pro_plan.html?",Attachment:"accessory.html?",Lender:"loan_lender.html?",LenderAccount:"account.html?from=home&",ProjectReport:"pro_report.html?"},o={Contract:"loan_list.html?contractId=",RepayPayable:"payments_list.html?from=Payable&repayId=",Node:"loan_node_list.html?nodeId=",Guarantee:"surety_guaranteeInfo_list.html?guaranteeId=",GuaranteeThing:"surety_loanThings_list.html?thingId=",Debtor:"loan_debtor_detail.html?debtorId=",Project:"pro_info_detail.html?projectNo=",ProjectPlan:"pro_play_detail.html?planNo=",PlanReport:"pro_plan_detail.html?scheduleNo=",Attachment:"accessoy_detail.html?attachmentId=",Lender:"loan_lender_detail.html?lenderId=",LenderAccount:"account_detail.html?accountId=",ProjectReport:"pro_report_detail.html?projectNo="};return a?o[t]+a:n[t]+"keyWord="+encodeURI(e.keyWord)})},init:function(){this.setUrl(),this.callback=this.getList,this.callFun=this.pageInit,this.type="search",search.init(this),this.pageInit()}},accessory={currentPage:1,keyWord:$("input[name=search]").val(),getList:function(e){var t=e?e:this;"s"==t.type&&(t.currentPage=1),$("#accessory-result").removeClass("none"),$(".accessory").addClass("none"),$(".self-tips").remove(),$(".ui-loading-wrap").removeClass("none").html(message.loading),$.ajax({type:"post",url:url+"/loanAttachment/list",data:{pageNum:t.currentPage,keyWord:t.keyWord},success:function(e){if(t.type="",0==e.code){var a=e.dataSource,n=template("accessoryTemp",a);1==t.currentPage?$(".accessory-list").html(n):$(".accessory-list").append(n),0==a.totalPage?($(".ui-loading-wrap").addClass("none"),tips({classname:"tips-no-message",content:message.noMssege})):a.totalPage<=t.currentPage&&$(".ui-loading-wrap").html(message.success),t.currentPage++}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},init:function(){this.type="fileSearch",this.callback=this.getList;var e=getUrlParam({name:"keyWord",type:"decode"});""!=e&&($("input[name=search]").val(e),this.keyWord=e,this.getList(this)),search.init(this),scrollFunc(this)}},loanAttachment={getInfo:function(){var e={relatedKey:getUrlParam({name:"relatedKey"}),relatedCategory:getUrlParam({name:"relatedCategory"})};$.ajax({type:"post",url:url+"/loanAttachmentRel/list",data:e,success:function(e){if(0==e.code)if(e.dataSource.attachmentList.length>0){var t=template("loanAttachmentTemp",e.dataSource);$(".repay-detail").html(t)}else tips({classname:"tips-no-message",content:message.noMssege});else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},init:function(){this.getInfo()}},accessory_detail={currentPage:1,getList:function(e){var t=e?e:this,a=getUrlParam({name:"attachmentId"});$(".self-tips").remove(),$(".ui-loading-wrap").removeClass("none").html(message.loading),$.ajax({type:"post",url:url+"/loanAttachmentRel/relatedModules",data:{pageNum:t.currentPage,attachmentId:a},success:function(e){if(0==e.code){var a=e.dataSource,n=template("accessoryDetailTemp",a);1==t.currentPage?$(".accessoryDetail").html(n):$(".accessoryDetail").append(n),0==a.totalPage?$(".ui-loading-wrap").addClass("none"):a.totalPage<=t.currentPage&&$(".ui-loading-wrap").html(message.success),t.currentPage++}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},init:function(){this.callback=this.getList,this.getList(),scrollFunc(this)}},boardList={getInfo:function(){var e=this;$.ajax({type:"post",url:url+"/ebank/bankCards",success:function(t){if(0==t.code){var a=template("boardListTemp",t.dataSource);$("#board-list").html(a),e.setNums("all"),document.title=$("input[name=companyName]").val(),$(".ui-loading-wrap").remove()}else $.tips({content:t.msg,stayTime:3e3}),999001==t.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},showSubsidiary:function(){$(document).on("click",".board-head-select",function(){var e=$(".board-select-list");e.hasClass("none")?e.removeClass("none"):e.addClass("none")})},selectedSubsidiary:function(){var e=this;$(document).on("click",".board-select-list li",function(){var t=$(this).data("id");if($(".board-list li").attr("data-flag",0),"all"==t){$(".board-list li").removeClass("none"),$(".board-head-company").removeClass("none");var a=$(".board-head-card").data("count");$(".board-head-card").html(a),$("#companyBalance").html($("#companyBalance").data("money")),$("#inflowamt").html($("#inflowamt").data("inflowamt")),$("#outflowamt").html($("#outflowamt").data("outflowamt"))}else{$(".board-list li").addClass("none");var n=$(".board-list li.board-list-"+t),o=n.data("money")?n.data("money"):0,s=n.data("inflowamt")?n.data("inflowamt"):0,i=n.data("outflowamt")?n.data("outflowamt"):0;$(".board-head-company").addClass("none"),$(".board-head-card").html(n.length?n.length:0),$("#companyBalance").html(o),$("#inflowamt").html(s),$("#outflowamt").html(i),n.attr("data-flag",1),n.removeClass("none")}return e.setNums(t),$(".board-select-list").addClass("none"),!1})},setNums:function(e){for(var t=document.getElementById("board-list-a").getElementsByTagName("li"),a=1,n=0;n<t.length;n++){var o=t[n].getAttribute("data-flag");1!=o&&"all"!=e||(t[n].getElementsByClassName("board-list-num")[0].innerHTML=a,a++)}},init:function(){this.getInfo(),this.selectedSubsidiary(),this.showSubsidiary()}},boardDetail={getInfo:function(){var e=getUrlParam({name:"bankCardId"});$.ajax({type:"post",url:url+"/ebank/transactionRecords",data:{bankCardId:e},success:function(e){if(0==e.code){var t=template("boardDetailTemp",e.dataSource);$("#boardDetail").html(t),$(".ui-loading-wrap").remove()}else $.tips({content:e.msg,stayTime:3e3}),999001==e.code&&setTimeout(function(){window.location.href="login.html"},1e3)},error:function(){$.tips({content:message.serverErr,stayTime:3e3})}})},getMore:function(){$(document).on("click",".board-detail-more",function(){var e=$(this).parents("li").children(".board-detail-hidden");return!$(this).hasClass("hidden")&&($(this).hasClass("active")?(e.addClass("none"),$(this).removeClass("active"),$(this).removeClass("hidden")):0==e.data("length")?$(this).addClass("hidden"):(e.removeClass("none"),$(this).addClass("active")),!1)})},getTags:function(){$(document).on("click",".board-head-info",function(){$("#model-tags").show()})},closeTags:function(){$(document).on("click",".rm-dialog-close",function(){return $(".ui-dialog").hide(),!1})},init:function(){this.getInfo(),this.getMore(),this.getTags(),this.closeTags()}};